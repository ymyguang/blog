# 面试集合



简历标准

![image-20240314085933126](C:\Users\admin.000\AppData\Roaming\Typora\typora-user-images\image-20240314085933126.png)



### Java的内存模型之方法区

#### 一、概括

`Java`代码被编译成字节码文件之后，通过类加载器被加载到**运行时数据区**。

运行时数据区分为:

	1. 虚拟机栈
	1. 本地方法栈
	1. 程序计数器
	1. 方法区
	1. 堆内存

![img](https://img-blog.csdnimg.cn/20200717184217124.PNG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTEwNjkyOTQ=,size_16,color_FFFFFF,t_70#pic_center)





![jvm-framework](https://pdai.tech/images/jvm/jvm/0082zybply1gc6fz21n8kj30u00wpn5v.jpg)

其中前三者是每个进程独有的，他们是是相互隔离的。而后者两个是公共的。

JVM存储是Java程序运行的数据，很显然运行的数据可以分成两类:

1. 类加载的的数据存储到内存
2. 类的初始化(new)出来的对象

其中方法区就是存储相对静态的数据，而堆就是存储类的创建之后得到的对象。

其中，方法区主要存储的是类型的相关信息以及运行时常量池。对于字符串常量，根据`JDK`版本的不同，有的放到了方法区，有的没有。

#### 二、方法区

##### 一个更加准确的概念：**方法区用于存储已被虚拟机加载的类型信息、常量、静态变量、即时编译器编译后的代码缓存等。**可见{类型信息、常量、静态变量、即时编译器编译后的代码缓存}都是静态的，实现写死的，特别是类的信息和stastic关键字修饰的信息。

因为方法区可以存储很多类型的Java数据，就像上面所讲的，因此方法区又被分开，更加细化的存储类的数据。

那么分别有哪些呢：

我们不妨直接自己思考一下：一个类有什么东西？

1. 存储加载的类的信息
   1. 类的名字
   2. 类的修饰符
   3. 类的父类
2. 常量，宽泛的来说应该是：静态的数据
   1. 静态变量
   2. 静态方法
   3. 静态类
3. 类中具体的内容
   1. 具体方法的名字，修饰符，返回值
   2. 具体方法中代码的逻辑
   3. 具体类的字段

同样把上面的内容抽象成一个类，换句话说直接分析一个类包含哪些东西就可以了。于是问题被简化成

类方面信息

方法信息

字段信息

我们可以这样想，那些Java的大佬们也能这样想，是不是后悔自己晚出生了几年？哈哈。言归正传，在JVM的方法区中基本是分了这些区域：

- 类型信息
- 域信息
- 方法信息



























你是否也有看不同的参考资料，有的内存结构图有方法区，有的又是永久代，元数据区，一脸懵逼的时候？

- **方法区（method area）\**只是 \*\*JVM 规范\*\*中定义的一个\**概念**，用于存储类信息、常量池、静态变量、JIT编译后的代码等数据，并没有规定如何去实现它，不同的厂商有不同的实现。而**永久代（PermGen）\**是 \*\*Hotspot\*\* 虚拟机特有的概念， Java8 的时候又被\**元空间**取代了，永久代和元空间都可以理解为方法区的落地实现。
- 永久代物理是堆的一部分，和新生代，老年代地址是连续的（受垃圾回收器管理），而元空间存在于本地内存（我们常说的堆外内存，不受垃圾回收器管理），这样就不受 JVM 限制了，也比较难发生OOM（都会有溢出异常）
- Java7 中我们通过`-XX:PermSize` 和 `-xx:MaxPermSize` 来设置永久代参数，Java8 之后，随着永久代的取消，这些参数也就随之失效了，改为通过`-XX:MetaspaceSize` 和 `-XX:MaxMetaspaceSize` 用来设置元空间参数
- 存储内容不同，元空间存储类的元信息，静态变量和常量池等并入堆中。相当于永久代的数据被分到了堆和元空间中
- 如果方法区域中的内存不能用于满足分配请求，则 Java 虚拟机抛出 `OutOfMemoryError`
- JVM 规范说方法区在逻辑上是堆的一部分，但目前实际上是与 Java 堆分开的（Non-Heap）

所以对于方法区，Java8 之后的变化：

- 移除了永久代（PermGen），替换为元空间（Metaspace）；
- 永久代中的 class metadata 转移到了 native memory（本地内存，而不是虚拟机）；
- 永久代中的 interned Strings 和 class static variables 转移到了 Java heap；
- 永久代参数 （PermSize MaxPermSize） -> 元空间参数（MetaspaceSize MaxMetaspaceSize）

------

著作权归@pdai所有 原文链接：https://pdai.tech/md/java/jvm/java-jvm-struct.html



